<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logs del Bot Discord</title>
    <link rel="stylesheet" href="../static/styles.css">
</head>
<body>
    <header>
        <h1>Logs del Bot Discord</h1>
    </header>

    <main>
        <div class="log-container" id="log-container"><div class="log-card message"><p>Cargando logs...</p></div></div>
    </main>

    <script>
        const apiParam = new URLSearchParams(location.search).get('api');
        const API_BASE_URL = apiParam ? apiParam.replace(/\/$/, '') : '';
        const container = document.getElementById('log-container');

        function renderLogs(data) {
            if (!Array.isArray(data) || data.length === 0) {
                container.innerHTML = `
                    <div class="log-card channel">
                        <p>Sin logs aún. Envía, edita o elimina un mensaje en tu servidor.</p>
                    </div>
                `;
                return;
            }
            container.innerHTML = data.map(log => `
                <div class="log-card ${log.type}" data-id="${log.id}">
                    <p>${log.content}</p>
                </div>
            `).join('');
        }

        function updateLogs() {
            if (!API_BASE_URL) {
                container.innerHTML = `
                    <div class="log-card message">
                        <p>Configura el parámetro <strong>?api=</strong> con la URL de tu backend.</p>
                    </div>
                `;
                return;
            }
            fetch(API_BASE_URL + '/api/logs')
                .then(response => response.json())
                .then(data => renderLogs(data))
                .catch(() => {
                    container.innerHTML = `
                        <div class="log-card delete">
                            <p>No se pudo obtener logs. Verifica la URL del backend y CORS.</p>
                        </div>
                    `;
                });
        }

        updateLogs();
        setInterval(updateLogs, 2000);
    </script>
</body>
</html>
